<!doctype html><html lang=en dir=ltr><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Malware Analysis Network Setup Guide | Lux-Sit</title><meta name=generator content="Hugo Eureka 0.9.3"><link rel=stylesheet href=https://alpharivs.github.io/css/eureka.min.9cec6350e37e534b0338fa9a085bf06855de3b0f2dcf857e792e5e97b07ea905d4d5513db554cbc26a9c3da622bae92d.css><script defer src=https://alpharivs.github.io/js/eureka.min.fa9a6bf6d7a50bb635b4cca7d2ba5cf3dfb095ae3798773f1328f7950028b48c17d06276594e1b5f244a25a6c969a705.js></script>
<link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Noto+Serif+SC:wght@400;600;700&display=swap" as=style onload='this.onload=null,this.rel="stylesheet"'><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/styles/base16/solarized-light.min.css media=print onload='this.media="all",this.onload=null' crossorigin><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/highlight.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/dart.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/bash.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/cpp.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/python.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/c.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/vbscript.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/powershell.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/http.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/x86asm.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/go.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/javascript.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/ruby.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/php.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/shell.min.js crossorigin></script>
<link rel=stylesheet href=https://alpharivs.github.io/css/highlightjs.min.2958991528e43eb6fc9b8c4f2b8e052f79c4010718e1d1e888a777620e9ee63021c2c57ec7417a3108019bb8c41943e6.css media=print onload='this.media="all",this.onload=null'><script defer type=text/javascript src=https://alpharivs.github.io/js/fontawesome.min.1a0e4e36d09c9b8c79729f1a7cb90dc225c79dcc45da26e3cb870b6f0c8e7c3cddf25cf0c93dcf203138152fff75823f.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ media=print onload='this.media="all",this.onload=null' crossorigin><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script defer src=https://cdn.jsdelivr.net/npm/mermaid@8.14.0/dist/mermaid.min.js integrity=sha384-atOyb0FxAgN9LyAc6PEf9BjgwLISyansgdH8/VXQH8p2o5vfrRgmGIJ2Sg22L0A0 crossorigin></script>
<link rel=icon type=image/png sizes=32x32 href=https://alpharivs.github.io/images/icon_hu4bae09c78eba04c5e7d71d1040233379_73006_32x32_fill_q75_box_center.jpg><link rel=apple-touch-icon sizes=180x180 href=https://alpharivs.github.io/images/icon_hu4bae09c78eba04c5e7d71d1040233379_73006_180x180_fill_q75_box_center.jpg><meta name=description content="A guide for creating an internal network for malware analysis with VirtualBox."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://alpharivs.github.io/malware/"},{"@type":"ListItem","position":2,"name":"Malware Analysis Network Setup Guide","item":"https://alpharivs.github.io/malware/lab-setup-guide/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://alpharivs.github.io/malware/lab-setup-guide/"},"headline":"Malware Analysis Network Setup Guide | Lux-Sit","image":"https://alpharivs.github.io/images/malware/computer_networking.jpg","datePublished":"2022-07-11T00:00:00+00:00","dateModified":"2022-07-11T00:00:00+00:00","wordCount":446,"author":{"@type":"Person","name":"Alpharivs"},"publisher":{"@type":"Person","name":"WANG Chucheng","logo":{"@type":"ImageObject","url":"https://alpharivs.github.io/images/icon.jpg"}},"description":"A guide for creating an internal network for malware analysis with VirtualBox."}</script><meta property="og:title" content="Malware Analysis Network Setup Guide | Lux-Sit"><meta property="og:type" content="article"><meta property="og:image" content="https://alpharivs.github.io/images/icon.jpg"><meta property="og:url" content="https://alpharivs.github.io/malware/lab-setup-guide/"><meta property="og:description" content="A guide for creating an internal network for malware analysis with VirtualBox."><meta property="og:locale" content="en"><meta property="og:site_name" content="Lux-Sit"><meta property="article:published_time" content="2022-07-11T00:00:00+00:00"><meta property="article:modified_time" content="2022-07-11T00:00:00+00:00"><meta property="article:section" content="malware"><meta property="article:tag" content="malware"><meta property="article:tag" content="analysis"><meta property="article:tag" content="remnux"><meta property="article:tag" content="lab"><meta property="article:tag" content="virtualization"><body class="flex min-h-screen flex-col"><header class="min-h-16 pl-scrollbar bg-secondary-bg fixed z-50 flex w-full items-center shadow-sm"><div class="mx-auto w-full max-w-screen-xl"><script>let storageColorScheme=localStorage.getItem("lightDarkMode");((storageColorScheme=="Auto"||storageColorScheme==null)&&window.matchMedia("(prefers-color-scheme: dark)").matches||storageColorScheme=="Dark")&&document.getElementsByTagName("html")[0].classList.add("dark")</script><nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0"><a href=/ class="me-6 text-primary-text text-xl font-bold">Lux-Sit</a>
<button id=navbar-btn class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
<i class="fas fa-bars"></i></button><div id=target class="hidden block md:flex md:grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20"><div class="md:flex md:h-16 text-sm md:grow pb-4 md:pb-0 border-b md:border-b-0"><a href=/malware/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 selected-menu-item me-4">Malware Analysis</a>
<a href=/writeups/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">CTF Write-ups</a>
<a href=/htb_writeups/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">HacktheBox Write-ups</a></div><div class=flex><div class="relative pt-4 md:pt-0"><div class="cursor-pointer hover:text-eureka" id=lightDarkMode><i class="fas fa-adjust"></i></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id=is-open></div><div class="absolute flex flex-col start-0 md:start-auto end-auto md:end-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40" id=lightDarkOptions><span class="px-4 py-1 hover:text-eureka" name=Light>Light</span>
<span class="px-4 py-1 hover:text-eureka" name=Dark>Dark</span>
<span class="px-4 py-1 hover:text-eureka" name=Auto>Auto</span></div></div></div></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id=is-open-mobile></div></nav><script>let element=document.getElementById("lightDarkMode");storageColorScheme==null||storageColorScheme=="Auto"?document.addEventListener("DOMContentLoaded",()=>{window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",switchDarkMode)}):storageColorScheme=="Light"?(element.firstElementChild.classList.remove("fa-adjust"),element.firstElementChild.setAttribute("data-icon","sun"),element.firstElementChild.classList.add("fa-sun")):storageColorScheme=="Dark"&&(element.firstElementChild.classList.remove("fa-adjust"),element.firstElementChild.setAttribute("data-icon","moon"),element.firstElementChild.classList.add("fa-moon")),document.addEventListener("DOMContentLoaded",()=>{getcolorscheme(),switchBurger()})</script></div></header><main class="grow pt-16"><div class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl lg:px-4 xl:px-8"><div class="grid grid-cols-2 gap-4 lg:grid-cols-8 lg:pt-12"><div class="bg-secondary-bg col-span-2 rounded px-6 py-8 lg:col-span-6"><article class=prose><h1 class=mb-4>Malware Analysis Network Setup Guide</h1><div class="text-tertiary-text not-prose mt-2 flex flex-row flex-wrap items-center"><div class="me-6 my-2"><i class="fas fa-calendar me-1"></i>
<span>2022-07-11</span></div><div class="me-6 my-2"><i class="fas fa-clock me-1"></i>
<span>3 min read</span></div><div class="me-6 my-2"><i class="fas fa-folder me-1"></i>
<a href=https://alpharivs.github.io/categories/guide/ class=hover:text-eureka>guide</a></div></div><img src=https://alpharivs.github.io/images/malware/computer_networking.jpg class=w-full alt="Featured Image"><h2 id=introduction>Introduction</h2><p>While I was first setting up my malware analysis lab I had to do some tedious troubleshooting and searching for information yielded too little (sometimes too much) information about how to properly set up an internal network so in an attempt to help those who just want to set up the lab (and to keep the notes of the process to myself) I wrote this post.</p><p>We will be setting up an <a href=https://docs.oracle.com/en/virtualization/virtualbox/6.0/user/network_internal.html>Internal Network</a> with <a href=https://www.virtualbox.org/>virtualbox</a> running on a <a href=https://www.microsoft.com/en-us/windows>Windows</a> host (the process for a Linux host machine is virtually the same) that will allow network interactions between a <a href=https://remnux.org/>Remnux</a> VM and a <a href=https://www.microsoft.com/en-us/windows>Windows</a> VM.</p><p>The end result will be something like this:</p><p><img src=images/Internal_network.jpg alt=internal></p><h2 id=host-machine-setup>Host Machine Setup</h2><h3 id=create-internal-network-in-virtualbox-app>Create Internal Network in VirtualBox App</h3><p>This step should be done in both the remnux and the windows virtual machines.</p><ul><li>Open the Virtual Machine settings</li><li>Select the Network Tab</li><li>Select Internal Network in the drop down menu</li><li>Rename the default intnet name to whatever you want to (malware in our case)</li></ul><p><img src=images/app_setup.png alt=app_setup></p><h3 id=create-a-dhcp-server-with-vboxmanageexe>Create a DHCP server with vboxmanage.exe</h3><p>First we must find vboxmanage.exe, it should be located in this location <strong>C:\Program Files\Oracle\VirtualBox</strong> if you chose the default installation path <em>Note: It must be run with cmd.exe as powershell has some issues parsing the flags</em></p><p>Now run the following command:</p><pre><code class=language-cmd>vboxmanage.exe dhcpserver add —netname malware —ip 10.10.10.1 —netmask 255.255.255.0 —lowerip 10.10.10.2 —upperip 10.10.10.5 —enable
</code></pre><p>You can run the following command to verify that the new DHCP server has been correctly created.</p><pre><code class=language-cmd>vboxmanage.exe list dhcpserver
</code></pre><h2 id=analysis-vm-remnux-v7-configuration>Analysis VM (Remnux v7) Configuration.</h2><h3 id=install-ifupdown>Install ifupdown</h3><p>This step is pretty straight forward, just run:</p><pre><code class=language-bash>sudo apt install ifupdown
</code></pre><h3 id=configure-the-etcnetworkinterfaces-file>Configure the /etc/network/interfaces file</h3><p>First we need to get the interface&rsquo;s name:</p><pre><code class=language-bash>ifconfig
</code></pre><p>The Name of the interface should be something like &ldquo;<strong>enp0s3</strong>&rdquo;, knowing the name now we can edit the &ldquo;/etc/network/interfaces&rdquo; file by adding the following (if the file does not exist, reboot the VM after installing ifupdown) :</p><pre><code class=language-bash>auto enp0s3
iface enp0s3 inet static
	address 10.10.10.2
	netmask 255.255.255.0
</code></pre><h2 id=windows-vm-configuration>Windows VM Configuration.</h2><p>Now we must assign an IP to our Windows VM and set our Analysis VM as the <a href=https://en.wikipedia.org/wiki/Default_gateway>Default Gateway</a>.</p><p>Go to <strong>Control Panel > Network and Sharing Center > Change Adapter Settings</strong> then:</p><ul><li>Right Click the interface and select properties.</li><li>Select Internet Protocol Version 4 and click Properties.</li><li>Manually configure the IP address, subnet mask, DHCP server and the Preferred DNS Server.</li></ul><p><img src=images/win_setup.png alt=win_setup></p><h2 id=conclusion>Conclusion</h2><p>And that&rsquo;s all, after all this setup network interactions coming from the infected Virtual Machine will go through the Analysis Machine while being completely isolated from your host&rsquo;s network, you can now analyze the traffic or even simulate responses to the malware requests using tools like FakeDNS and inetsim :)</p><p>Happy Hunting!</p></article><div class=my-4><a href=https://alpharivs.github.io/tags/malware/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#malware</a>
<a href=https://alpharivs.github.io/tags/analysis/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#analysis</a>
<a href=https://alpharivs.github.io/tags/remnux/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#remnux</a>
<a href=https://alpharivs.github.io/tags/lab/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#lab</a>
<a href=https://alpharivs.github.io/tags/virtualization/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#virtualization</a></div><div class=py-2><div class="my-8 flex flex-col items-center md:flex-row"><a href=https://alpharivs.github.io/authors/alpharivs/ class="md:me-4 text-primary-text h-24 w-24"><img src=https://alpharivs.github.io/images/profile.jpg class="bg-primary-bg w-full rounded-full" alt=Avatar></a><div class="mt-4 w-full md:mt-0 md:w-auto"><a href=https://alpharivs.github.io/authors/alpharivs/ class="mb-2 block border-b pb-1 text-lg font-bold"><h3>Alpharivs</h3></a><span class="block pb-2">Eternal Cybersecurity student with love for Malware and CTFs</span>
<a href=mailto:caliburn@tutanota.de class=me-2><i class="fas fa-envelope"></i></a>
<a href=https://twitter.com/alpharivs class=me-2><i class="fab fa-twitter"></i></a>
<a href=https://github.com/Alpharivs class=me-2><i class="fab fa-github"></i></a>
<a href=https://app.hackthebox.com/users/525385 class=me-2><i class="fab fa-jedi-order"></i></a></div></div></div><div class="-mx-2 mt-4 flex flex-col border-t px-2 pt-4 md:flex-row md:justify-between"><div><span class="text-primary-text block font-bold">Previous</span>
<a href=https://alpharivs.github.io/malware/wannacry/dropper/ class=block>Wannacry - Part 1</a></div><div class="mt-4 md:mt-0 md:text-right"></div></div></div><div class=col-span-2><div class="bg-primary-bg
prose sticky top-16 z-10 hidden px-6 py-4 lg:block"><h3>On This Page</h3></div><div class="sticky-toc hidden px-6 pb-6 lg:block"><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#host-machine-setup>Host Machine Setup</a><ul><li><a href=#create-internal-network-in-virtualbox-app>Create Internal Network in VirtualBox App</a></li><li><a href=#create-a-dhcp-server-with-vboxmanageexe>Create a DHCP server with vboxmanage.exe</a></li></ul></li><li><a href=#analysis-vm-remnux-v7-configuration>Analysis VM (Remnux v7) Configuration.</a><ul><li><a href=#install-ifupdown>Install ifupdown</a></li><li><a href=#configure-the-etcnetworkinterfaces-file>Configure the /etc/network/interfaces file</a></li></ul></li><li><a href=#windows-vm-configuration>Windows VM Configuration.</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div><script>window.addEventListener("DOMContentLoaded",()=>{enableStickyToc()})</script></div></div><script>document.addEventListener("DOMContentLoaded",()=>{hljs.highlightAll()})</script></div></div></main><footer class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl"><div class="text-center p-6 pin-b"><p class="text-sm text-tertiary-text">&copy; 2022 <a href=https://twitter.com/alpharivs>Alpharivs</a>
&#183; Powered by the <a href=https://github.com/wangchucheng/hugo-eureka class=hover:text-eureka>Eureka</a> theme for <a href=https://gohugo.io class=hover:text-eureka>Hugo</a></p></div></div></footer></body></html>