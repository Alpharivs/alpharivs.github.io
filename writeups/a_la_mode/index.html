<!doctype html><html lang=en dir=ltr><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Flare-On 2022 - à la mode | Lux-Sit</title><meta name=generator content="Hugo Eureka 0.9.3"><link rel=stylesheet href=https://alpharivs.github.io/css/eureka.min.9cec6350e37e534b0338fa9a085bf06855de3b0f2dcf857e792e5e97b07ea905d4d5513db554cbc26a9c3da622bae92d.css><script defer src=https://alpharivs.github.io/js/eureka.min.fa9a6bf6d7a50bb635b4cca7d2ba5cf3dfb095ae3798773f1328f7950028b48c17d06276594e1b5f244a25a6c969a705.js></script>
<link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Noto+Serif+SC:wght@400;600;700&display=swap" as=style onload='this.onload=null,this.rel="stylesheet"'><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/styles/base16/solarized-light.min.css media=print onload='this.media="all",this.onload=null' crossorigin><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/highlight.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/dart.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/bash.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/cpp.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/python.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/c.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/vbscript.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/powershell.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/http.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/x86asm.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/go.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/javascript.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/ruby.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/php.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/shell.min.js crossorigin></script>
<link rel=stylesheet href=https://alpharivs.github.io/css/highlightjs.min.2958991528e43eb6fc9b8c4f2b8e052f79c4010718e1d1e888a777620e9ee63021c2c57ec7417a3108019bb8c41943e6.css media=print onload='this.media="all",this.onload=null'><script defer type=text/javascript src=https://alpharivs.github.io/js/fontawesome.min.5326b5f9c61e2373bd99194e0e41377b1e5e42801f5fc0f2a11fe5ac898837b5e0e86b52e854fc435c595e22ec6a61b1.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ media=print onload='this.media="all",this.onload=null' crossorigin><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script defer src=https://cdn.jsdelivr.net/npm/mermaid@8.14.0/dist/mermaid.min.js integrity=sha384-atOyb0FxAgN9LyAc6PEf9BjgwLISyansgdH8/VXQH8p2o5vfrRgmGIJ2Sg22L0A0 crossorigin></script>
<link rel=icon type=image/png sizes=32x32 href=https://alpharivs.github.io/images/icon_hu4bae09c78eba04c5e7d71d1040233379_73006_32x32_fill_q75_box_center.jpg><link rel=apple-touch-icon sizes=180x180 href=https://alpharivs.github.io/images/icon_hu4bae09c78eba04c5e7d71d1040233379_73006_180x180_fill_q75_box_center.jpg><meta name=description content="Write-up for à la mode Flare-on 2022 challenge"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://alpharivs.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"Flare-On 2022 - à la mode","item":"https://alpharivs.github.io/writeups/a_la_mode/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://alpharivs.github.io/writeups/a_la_mode/"},"headline":"Flare-On 2022 - à la mode | Lux-Sit","image":"https://alpharivs.github.io/images/writeups/flare.png","datePublished":"2022-11-26T00:00:00+00:00","dateModified":"2022-11-26T00:00:00+00:00","wordCount":1228,"author":{"@type":"Person","name":"Alpharivs"},"publisher":{"@type":"Person","name":"WANG Chucheng","logo":{"@type":"ImageObject","url":"https://alpharivs.github.io/images/icon.jpg"}},"description":"Write-up for à la mode Flare-on 2022 challenge"}</script><meta property="og:title" content="Flare-On 2022 - à la mode | Lux-Sit"><meta property="og:type" content="article"><meta property="og:image" content="https://alpharivs.github.io/images/icon.jpg"><meta property="og:url" content="https://alpharivs.github.io/writeups/a_la_mode/"><meta property="og:description" content="Write-up for à la mode Flare-on 2022 challenge"><meta property="og:locale" content="en"><meta property="og:site_name" content="Lux-Sit"><meta property="article:published_time" content="2022-11-26T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-26T00:00:00+00:00"><meta property="article:section" content="writeups"><meta property="article:tag" content="reversing"><meta property="article:tag" content="static"><meta property="article:tag" content="C#"><meta property="article:tag" content=".Net"><meta property="article:tag" content="Mixed-mode"><meta property="article:tag" content="challenge"><meta property="og:see_also" content="https://alpharivs.github.io/writeups/challenge_teight/"><meta property="og:see_also" content="https://alpharivs.github.io/writeups/darn_mice/"><meta property="og:see_also" content="https://alpharivs.github.io/writeups/magic_8_ball/"><meta property="og:see_also" content="https://alpharivs.github.io/writeups/flare_flaredle/"><meta property="og:see_also" content="https://alpharivs.github.io/writeups/flare_pixelpoker/"><meta property="og:see_also" content="https://alpharivs.github.io/malware/wannacry/launcher/"><body class="flex min-h-screen flex-col"><header class="min-h-16 pl-scrollbar bg-secondary-bg fixed z-50 flex w-full items-center shadow-sm"><div class="mx-auto w-full max-w-screen-xl"><script>let storageColorScheme=localStorage.getItem("lightDarkMode");((storageColorScheme=="Auto"||storageColorScheme==null)&&window.matchMedia("(prefers-color-scheme: dark)").matches||storageColorScheme=="Dark")&&document.getElementsByTagName("html")[0].classList.add("dark")</script><nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0"><a href=/ class="me-6 text-primary-text text-xl font-bold">Lux-Sit</a>
<button id=navbar-btn class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
<i class="fas fa-bars"></i></button><div id=target class="hidden block md:flex md:grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20"><div class="md:flex md:h-16 text-sm md:grow pb-4 md:pb-0 border-b md:border-b-0"><a href=/malware/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">Malware Analysis</a>
<a href=/writeups/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 selected-menu-item me-4">CTF Write-ups</a>
<a href=/htb_writeups/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">HacktheBox Write-ups</a></div><div class=flex><div class="relative pt-4 md:pt-0"><div class="cursor-pointer hover:text-eureka" id=lightDarkMode><i class="fas fa-adjust"></i></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id=is-open></div><div class="absolute flex flex-col start-0 md:start-auto end-auto md:end-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40" id=lightDarkOptions><span class="px-4 py-1 hover:text-eureka" name=Light>Light</span>
<span class="px-4 py-1 hover:text-eureka" name=Dark>Dark</span>
<span class="px-4 py-1 hover:text-eureka" name=Auto>Auto</span></div></div></div></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id=is-open-mobile></div></nav><script>let element=document.getElementById("lightDarkMode");storageColorScheme==null||storageColorScheme=="Auto"?document.addEventListener("DOMContentLoaded",()=>{window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",switchDarkMode)}):storageColorScheme=="Light"?(element.firstElementChild.classList.remove("fa-adjust"),element.firstElementChild.setAttribute("data-icon","sun"),element.firstElementChild.classList.add("fa-sun")):storageColorScheme=="Dark"&&(element.firstElementChild.classList.remove("fa-adjust"),element.firstElementChild.setAttribute("data-icon","moon"),element.firstElementChild.classList.add("fa-moon")),document.addEventListener("DOMContentLoaded",()=>{getcolorscheme(),switchBurger()})</script></div></header><main class="grow pt-16"><div class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl lg:px-4 xl:px-8"><div class="grid grid-cols-2 gap-4 lg:grid-cols-8 lg:pt-12"><div class="bg-secondary-bg col-span-2 rounded px-6 py-8 lg:col-span-6"><article class=prose><h1 class=mb-4>Flare-On 2022 - à la mode</h1><div class="text-tertiary-text not-prose mt-2 flex flex-row flex-wrap items-center"><div class="me-6 my-2"><i class="fas fa-calendar me-1"></i>
<span>2022-11-26</span></div><div class="me-6 my-2"><i class="fas fa-clock me-1"></i>
<span>6 min read</span></div><div class="me-6 my-2"><i class="fas fa-folder me-1"></i>
<a href=https://alpharivs.github.io/categories/write-ups/ class=hover:text-eureka>write-ups</a></div></div><img src=https://alpharivs.github.io/images/writeups/flare.png class=w-full alt="Featured Image"><h2 id=challenge-description>Challenge Description</h2><pre><code class=language-text>FLARE FACT #824: Disregard flare fact #823 if you are a .NET Reverser too.
We will now reward your fantastic effort with a small binary challenge. You’ve earned it kid!
</code></pre><h2 id=basic-static-analysis>Basic Static Analysis</h2><p>We are given what appears to be a .Net Dll and a chat log</p><pre><code class=language-bash>file *
HowDoesThisWork.dll: PE32 executable (DLL) (GUI) Intel 80386 Mono/.Net assembly, for MS Windows
IR chat log.txt:     ASCII text, with CRLF line terminators
</code></pre><p>The Dll seems to be missing the executable that is supposed to interact with it according to the text file.</p><pre><code class=language-bash>cat 'IR chat log.txt'
[FLARE Team]  Hey IR Team, it looks like this sample has some other binary that might 
              interact with it, do you have any other files that might be of help.			
[IR Team]     Nope, sorry this is all we got from the client, let us know what you got.
</code></pre><h3 id=imports>Imports</h3><p>Looking at the imports we see something quite interesting.</p><p><img src=images/imports.png alt=imports></p><p>In a .NET assembly the only import that we should see is <strong>mscoree.dll</strong> in our case <strong>kernel32.dll</strong> is also imported that is a sign of <a href="https://learn.microsoft.com/en-us/cpp/dotnet/mixed-native-and-managed-assemblies?view=msvc-170">mixed-mode</a>.</p><h3 id=headers>Headers</h3><p>Loading the Dll in <strong>dnSpy</strong> confirms our suspicion of mixed-mode being present.</p><p><img src=images/netunmanaged.png alt=netunmanaged></p><p>If we examine the optional header we see that it defines an <strong>AddressOfEntryPoint</strong>.</p><p><img src=images/optionalentry.png alt=optionalentry></p><p>That address will load the <strong>DllEntryPoint</strong> which immediately calls <strong>CorDllMain</strong>, but we are interested in reaching the unmanaged code, by checking the <strong>COR20</strong> we can get the address of the entry point that leads to the unmanaged code.
<img src=images/mixedmode.png alt=mixedmode></p><h2 id=advanced-static-analysis>Advanced Static Analysis</h2><h3 id=managed-code>Managed Code.</h3><p>When loading the Dll in <strong>dnSpy</strong> and analyze it&rsquo;s functionality we can immediately see the following:</p><ul><li>An empty constructor.</li></ul><pre><code class=language-cs>// FlareOn.Flag
// Token: 0x06000002 RID: 2 RVA: 0x0000D158 File Offset: 0x0000C558
public Flag()
{
}
</code></pre><ul><li>A method containing a function named GetFlag that takes a string labeled <strong>password</strong>.</li></ul><pre><code class=language-cs>// FlareOn.Flag
// Token: 0x06000001 RID: 1 RVA: 0x0000D078 File Offset: 0x0000C478
public string GetFlag(string password)
{
	Decoder decoder = Encoding.UTF8.GetDecoder();
	UTF8Encoding utf8Encoding = new UTF8Encoding();
	string text = &quot;&quot;;
	byte[] array = new byte[64];
	char[] array2 = new char[64];
	byte[] bytes = utf8Encoding.GetBytes(password + &quot;\0&quot;);
	using (NamedPipeClientStream namedPipeClientStream = new NamedPipeClientStream(&quot;.&quot;, &quot;FlareOn&quot;, PipeDirection.InOut))
	{
		namedPipeClientStream.Connect();
		namedPipeClientStream.ReadMode = PipeTransmissionMode.Message;
		namedPipeClientStream.Write(bytes, 0, Math.Min(bytes.Length, 64));
		int byteCount = namedPipeClientStream.Read(array, 0, array.Length);
		int chars = decoder.GetChars(array, 0, byteCount, array2, 0);
		text += new string(array2, 0, chars);
	}
	return text;
}
</code></pre><p>The manage code is taking the string parameter <strong>password</strong> and writing it to a pipe then it reads back a response and returns it.</p><h3 id=unmanaged-code>Unmanaged Code</h3><p>We now know what the managed code does but the meat of the challenge lies in the unmanaged code so let&rsquo;s analyze it by loading it into <strong>Ida</strong>.</p><p>Note: to correctly analyze the unmanaged code we must choose &ldquo;Portable executable for 80386(PE) [pe64.so]&rdquo;
<img src=images/idaopen.png alt=idaopen></p><p>Once loaded we can jump to the entry point that we found when inspecting the <strong>COR20</strong> header (offset <strong>0x181A</strong>, VA would be <strong>0x1000181A</strong>)</p><p>The code isn&rsquo;t recognized as a function so we need to select it and press &ldquo;p&rdquo; to fix that, that will leave us in the function <strong>__DllMainCRTStartup</strong>, from there we can navigate following the calls to <strong>dllmain_dispatch</strong> where we will find function <strong>0x10001163</strong> which we can rename to <strong>DllMain</strong>.</p><h4 id=suspicious-strings>Suspicious Strings</h4><p>Dll main First calls a function <strong>sub_100012F1</strong> this function passes a lot of sus strings to another function labeled <strong>sub_100014AE</strong>.</p><p><img src=images/passing_strings.png alt=passing_strings></p><p>Which based on our analysis <strong>xors</strong> the sus strings with <strong>0x17</strong>.</p><pre><code class=language-asm>.text:100014C4 xor     al, 17h
</code></pre><p>Let&rsquo;s find all the sus strings and try to decode them to see what they really are.
<img src=images/sus_strings.png alt=sus_strings></p><p>NOTE: for some reason letter &ldquo;h&rdquo; is not correctly displayed but that&rsquo;s quickly inferred and thus has been fixed bellow.</p><pre><code class=language-text>Vbc',7Fh,'xe~mvc~xy7Qv~{rs - Authorization Failed.
KK9Kg~grKQ{verXy - \\.\pipe\FlareOn
T{xdr_vys{r - CloseHandle
TxyyrtcYvzrsG~gr - ConnectNamedPipe
TervcrYvzrsG~grV - CreateNamedPipeA
TervcrC',7Fh,'ervs - CreateThread
S~dtxyyrtcYvzrsG~gr - DisconnectNamedPipe
Q~{rUbqqred - FileBuffers
Prc[vdcReexe - GetLastError
PrcGextrdd_rvg - GetProcessHeap
{dcetzgV - lstrcmpA
ErvsQ~{r - ReadFile
@e~crQ~{r - WriteFile
</code></pre><p>We can conclude that function <strong>sub_100012F1</strong> is a dynamic API resolver.</p><p>This simplifies the analysis of the executable as we can know rename the sus strings giving us a much clearer picture as the image below of <strong>DllMain</strong> shows.</p><p><img src=images/cthread.png alt=cthread></p><h4 id=create-thread>Create Thread</h4><p>The function used in the call to Create Thread (<strong>FUN_10001094</strong>) connects to a pipe, reads data from the pipe and then passes that date to function <strong>FUN_10001000</strong> and then it writes back to the pipe.</p><pre><code class=language-c>  pipe_name = xor_function(\\.\pipe\FlareOn,&amp;DAT_100159d8);
  pipe_name = (*CreateNamedPipeA)(pipe_name,dwOpenMode,dwPipeMode,nMaxInstances,nOutBuffe rSize,nInBufferSize,nDefaultTimeOut,lpSecurityAttributes);
  if (pipe_name != -1) {
    pipe_handle = (*ConnectNamedPipe)(pipe_name,0);
    if (pipe_handle == 0) {
      (*GetLastError)();
    }
    pipe_handle = (*ReadFile)(pipe_name,lpBuffer,0x40,&amp;lpNumberOfBytesRead,0);
    if ((pipe_handle == 0) || (lpNumberOfBytesRead == 0)) {
      (*GetLastError)();
    }
    else {
      (*CreateThread)(pipe_name);
      lpBuffer[lpNumberOfBytesRead] = 0;
                    /* lpBuffer has recv data */
      FUN_10001000(lpBuffer,&amp;nNumberOfBytesToWrite);
      (*WriteFile)(pipe_name,lpBuffer,nNumberOfBytesToWrite,lpNumberOfBytesWritten,0);
    }
    (*CreateThread)(pipe_name);
    (*DisconnectNamedPipe)(pipe_name);
    (*CloseHandle)(pipe_name);
  }
  return 0;
}
</code></pre><p>We can guess that function <strong>FUN_10001000</strong> probably makes some sort of check so let&rsquo;s analyze it.</p><h4 id=rc4>RC4</h4><p>After analyzing the calls that this function makes turns out that <strong>FUN_100011ef</strong> is an RC4 KSA function given the indicators in the assembly code.</p><p>(<a href=https://www.goggleheadedhacker.com/blog/post/reversing-crypto-functions#rc4-algorithm>This</a> is a really good post to identify this type of functions by just analyzing the disassembly.)</p><p>That means that the function <strong>FUN_10001187</strong> must be the RC4 PRGA function.</p><p>Now we can rename everything accordingly and we end up with the following code.</p><pre><code class=language-c>{
  ...(SNIP)...
  RC4_KSA(s,&amp;key_data,8);
  RC4_PRGA(s,&amp;encrypted_data1,9);
  comparison = (*lstrcmpA)(&amp;encrypted_data1,pipe_data);
  if (comparison == 0) {
    Authorization_Failed = &amp;encrypted_data2;
    RC4_PRGA(s,&amp;encrypted_data2,0x1f);
    *byte_num? = 0x1f;
  }
  else {
    *byte_num? = 0x15;
    Authorization_Failed = xor_function(AthorizationFailed,&amp;DAT_100159d8);
  }
  (*DAT_10015a20)(pipe_data,Authorization_Failed);
  return comparison == 0;
}
</code></pre><p>We see that the data received through the pipe is being validated using <strong>lstrcmpA</strong> against a RC4 encrypted string which we could decrypt if we extract the key.</p><h2 id=flag>Flag</h2><p>We can extract the Flag using 2 methods.</p><h3 id=method-1---create-net-console-app>Method 1 - Create .Net console app</h3><p>As hinted in the in the log file an executable used to interact with the Dll is missing so let&rsquo;s create it.</p><h4 id=extract-password>Extract Password</h4><p>First we need to extract the key from the <strong>RC4 KSA</strong> function and the encrypted data from <strong>RC4 PRGA</strong></p><p><img src=images/byte_extraction.png alt=byte_extraction></p><p>With both extracted we can create a python script that decrypts the data used in the RC4 PRGA.</p><pre><code class=language-python>from Crypto.Cipher import ARC4

key = b'\x55\x8B\xEC\x83\xEC\x20\xEB\xFE'

encrypted_data1 = b'\x3e\x39\x51\xfb\xa2\x11\xf7\xb9\x2c'

cipher = ARC4.new(key)
print('Encrypted Data 1: {}'.format(cipher.decrypt(encrypted_data1).decode()))
</code></pre><p>Success!</p><pre><code class=language-bash>Encrypted Data 1: 'MyV0ic3!'
</code></pre><h4 id=create-console-app>Create Console App</h4><p>Now we can create a <strong>.Net C# Console Application</strong> using <strong>Visual Studio</strong>.</p><pre><code class=language-cs>using System;
using FlareOn;
namespace FlareOn_app
{
	class Program
	{
		static void Main()
		{
			Console.WriteLine(&quot;Got it!: {0}&quot;, new Flag().GetFlag(&quot;MyV0ic3!&quot;));
		}
	}
}
</code></pre><p>We must add the DLL as a reference and also rename it to &ldquo;<strong>FlareOn_x86.dll</strong>&rdquo;.</p><p>Now we run it and hope that it works.</p><pre><code class=language-powershell>Directory of C:\Users\Euryale\Desktop\Solution

09/27/2022  06:28 AM            78,848 FlareOn_x86.dll
11/26/2022  02:46 PM             4,608 solver.exe
               2 File(s)         83,456 bytes

C:\Users\Euryale\Desktop\Solution&gt; solver.exe

&quot;Got it!: M1x3d_M0dE_4_l1f3@flare-on.com&quot;
</code></pre><p>Voila! We have the flag.</p><h3 id=method-2---pure-python>Method 2 - Pure Python</h3><p>Upon further analyzing the algorithm the challenge can also be solved without creating the .Net C# console app hassle (albeit it&rsquo;s more fun than just using python).</p><p>if the comparison between the RC4 decrypted data and the received data from the pipe succeeds another decryption using the same key takes place:</p><pre><code class=language-c>  comparison = (*lstrcmpA)(&amp;encrypted_data1,pipe_data);
  if (comparison == 0) {
    Authorization_Failed = &amp;encrypted_data2;
    RC4_PRGA(local_40c,&amp;encrypted_data2,0x1f);
    *byte_num? = 0x1f;
  }
</code></pre><p>If we add that data to our script:</p><pre><code class=language-python>from Crypto.Cipher import ARC4

key = b'\x55\x8B\xEC\x83\xEC\x20\xEB\xFE'

encrypted_data1 = b'\x3e\x39\x51\xfb\xa2\x11\xf7\xb9\x2c'
encrypted_data2 = b'\xe1\x60\xa1\x18\x93\x2e\x96\xad\x73\xbb\x4a\x92\xde\x18\x0a\xaa\x41\x74\xad\xc0\x1d\x9f\x3f\x19\xff\x2b\x02\xdb\xd1\xcd\x1a'

cipher = ARC4.new(key)
print('Encrypted Data 1: {}'.format(cipher.decrypt(encrypted_data1).decode()))
print('Encrypted Data 2: {}'.format(cipher.decrypt(encrypted_data2).decode()))
</code></pre><p>We can also get the flag in this way.</p><pre><code class=language-bash>Encrypted Data 1: 'MyV0ic3!'
Encrypted Data 2: 'M1x3d_M0dE_4_l1f3@flare-on.com'
</code></pre><p>Lux-Sit</p></article><div class=my-4><a href=https://alpharivs.github.io/tags/reversing/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#reversing</a>
<a href=https://alpharivs.github.io/tags/static/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#static</a>
<a href=https://alpharivs.github.io/tags/c#/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#C#</a>
<a href=https://alpharivs.github.io/tags/.net/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#.Net</a>
<a href=https://alpharivs.github.io/tags/mixed-mode/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#Mixed-mode</a>
<a href=https://alpharivs.github.io/tags/challenge/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#challenge</a>
<a href=https://alpharivs.github.io/tags/ctf/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#ctf</a>
<a href=https://alpharivs.github.io/tags/flare-on/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#flare-on</a></div><div class=py-2><div class="my-8 flex flex-col items-center md:flex-row"><a href=https://alpharivs.github.io/authors/alpharivs/ class="md:me-4 text-primary-text h-24 w-24"><img src=https://alpharivs.github.io/images/profile.jpg class="bg-primary-bg w-full rounded-full" alt=Avatar></a><div class="mt-4 w-full md:mt-0 md:w-auto"><a href=https://alpharivs.github.io/authors/alpharivs/ class="mb-2 block border-b pb-1 text-lg font-bold"><h3>Alpharivs</h3></a><span class="block pb-2">Eternal Cybersecurity student with love for Malware and CTFs</span>
<a href=mailto:caliburn@tutanota.de class=me-2><i class="fas fa-envelope"></i></a>
<a href=https://twitter.com/alpharivs class=me-2><i class="fab fa-twitter"></i></a>
<a href=https://github.com/Alpharivs class=me-2><i class="fab fa-github"></i></a>
<a href=https://app.hackthebox.com/users/525385 class=me-2><i class="fab fa-jedi-order"></i></a></div></div></div><div class="-mx-2 mt-4 flex flex-col border-t px-2 pt-4 md:flex-row md:justify-between"><div><span class="text-primary-text block font-bold">Previous</span>
<a href=https://alpharivs.github.io/writeups/anode/ class=block>Flare-On 2022 - anode</a></div><div class="mt-4 md:mt-0 md:text-right"><span class="text-primary-text block font-bold">Next</span>
<a href=https://alpharivs.github.io/writeups/challenge_teight/ class=block>Flare-On 2022 - T8</a></div></div></div><div class=col-span-2><div class="bg-primary-bg
prose sticky top-16 z-10 hidden px-6 py-4 lg:block"><h3>On This Page</h3></div><div class="sticky-toc hidden px-6 pb-6 lg:block"><nav id=TableOfContents><ul><li><a href=#challenge-description>Challenge Description</a></li><li><a href=#basic-static-analysis>Basic Static Analysis</a><ul><li><a href=#imports>Imports</a></li><li><a href=#headers>Headers</a></li></ul></li><li><a href=#advanced-static-analysis>Advanced Static Analysis</a><ul><li><a href=#managed-code>Managed Code.</a></li><li><a href=#unmanaged-code>Unmanaged Code</a><ul><li><a href=#suspicious-strings>Suspicious Strings</a></li><li><a href=#create-thread>Create Thread</a></li><li><a href=#rc4>RC4</a></li></ul></li></ul></li><li><a href=#flag>Flag</a><ul><li><a href=#method-1---create-net-console-app>Method 1 - Create .Net console app</a><ul><li><a href=#extract-password>Extract Password</a></li><li><a href=#create-console-app>Create Console App</a></li></ul></li><li><a href=#method-2---pure-python>Method 2 - Pure Python</a></li></ul></li></ul></nav></div><script>window.addEventListener("DOMContentLoaded",()=>{enableStickyToc()})</script></div><div class="bg-secondary-bg prose col-span-2 rounded p-6 lg:col-span-6"><h3>See Also</h3><a href=https://alpharivs.github.io/writeups/challenge_teight/ class=no-underline>Flare-On 2022 - T8</a><br><a href=https://alpharivs.github.io/writeups/darn_mice/ class=no-underline>Flare-On 2022 - darn_mice</a><br><a href=https://alpharivs.github.io/writeups/magic_8_ball/ class=no-underline>Flare-On 2022 - Magic 8 Ball</a><br><a href=https://alpharivs.github.io/writeups/flare_flaredle/ class=no-underline>Flare-On 2022 - Flaredle</a><br><a href=https://alpharivs.github.io/writeups/flare_pixelpoker/ class=no-underline>Flare-On 2022 - Pixel Poker</a><br><a href=https://alpharivs.github.io/malware/wannacry/launcher/ class=no-underline>Wannacry - Part 2</a><br></div></div><script>document.addEventListener("DOMContentLoaded",()=>{hljs.highlightAll()})</script></div></div></main><footer class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl"><div class="text-center p-6 pin-b"><p class="text-sm text-tertiary-text">&copy; 2022 <a href=https://twitter.com/alpharivs>Alpharivs</a>
&#183; Powered by the <a href=https://github.com/wangchucheng/hugo-eureka class=hover:text-eureka>Eureka</a> theme for <a href=https://gohugo.io class=hover:text-eureka>Hugo</a></p></div></div></footer></body></html>